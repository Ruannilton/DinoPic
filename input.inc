#ifndef INPUT_INC
#define INPUT_INC
    
#include "lib.inc"
    
KEY_ASTER    EQU  B'00111111'   
KEY_HASH     EQU  B'01111111'
KEY_NONE     EQU  B'00011111'
KEY_0	     EQU  B'00000000'
KEY_1	     EQU  D'1'
KEY_2	     EQU  D'2'
KEY_3	     EQU  D'3'
KEY_4	     EQU  D'4'
KEY_5	     EQU  D'5'
KEY_6	     EQU  D'6'
KEY_7	     EQU  D'7'
KEY_8	     EQU  D'8'
KEY_9	     EQU  D'9'	 

	
	
    
    
DEFINE_INPUT_FUNCS MACRO CORNIO_INPUT_VAL
#IFNDEF CORNIO_INPUT_FUNC_DEF
#DEFINE CORNIO_INPUT_FUNC_DEF


ENABLE_KEYBOARD:
    BANK1
     MOVLW B'00001111'
     MOVWF TRISA
    CLRF TRISB
    MOVLW B'00001111'
    MOVWF TRISD
    BANK0
    MOVLW B'00000000'
    MOVWF PORTB
    RETURN
    
 CORNIO_INPUT_LOOP:
    BANK1
     MOVLW B'00001111'
     MOVWF TRISA
    CLRF TRISB
    MOVLW B'00001111'
    MOVWF TRISD
    BANK0
    MOVLW B'00000000'
    MOVWF PORTB
 CORNIO_INPUT_LOOP_INI:
    MOVLW KEY_NONE
    MOVWF CORNIO_INPUT_VAL
    
    BCF PORTB, RB0
    BTFSS TRISD, RD0
    GOTO CORNIO_MOV_ASTER	; *
    CALL CORNIO_INPUT_DELAY
    
    BTFSS TRISD, RD1
    GOTO CORNIO_MOV7		; 7
    CALL CORNIO_INPUT_DELAY

    BTFSS TRISD, RD2
    GOTO CORNIO_MOV4		; 4
    CALL CORNIO_INPUT_DELAY

    BTFSS TRISD, RD3
    GOTO CORNIO_MOV1		;1
    CALL CORNIO_INPUT_DELAY
    BSF PORTB, RB0
    
    ;;
    BCF PORTB, RB1
    BTFSS TRISD, RD0
    GOTO CORNIO_MOV0		;0
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD1
    GOTO CORNIO_MOV8		;8
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD2
    GOTO CORNIO_MOV5		;5
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD3
    GOTO CORNIO_MOV2		;2
    CALL CORNIO_INPUT_DELAY
    BSF PORTB, RB1
    
    ;;
    BCF PORTB, RB2
    BTFSS TRISD, RD0
    GOTO CORNIO_MOV_HASH	;#
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD3
    GOTO CORNIO_MOV3		;3
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD2
    GOTO CORNIO_MOV6		;6
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD1
    GOTO CORNIO_MOV9		;9
    CALL CORNIO_INPUT_DELAY
    BSF PORTB, RB2
    ;;
    
    GOTO CORNIO_INPUT_LOOP_INI
  
    
CORNIO_INPUT:
    BANK1
    MOVLW B'00001111'
    MOVWF TRISA
    CLRF TRISB
    MOVLW B'00001111'
    MOVWF TRISD
    BANK0
    MOVLW B'00000000'
    MOVWF PORTB
    
    MOVLW KEY_NONE
    MOVWF CORNIO_INPUT_VAL
    
    BCF PORTB, RB0
    BTFSS TRISD, RD0
    GOTO CORNIO_MOV_ASTER	; *
    CALL CORNIO_INPUT_DELAY
    
    BTFSS TRISD, RD1
    GOTO CORNIO_MOV7		; 7
    CALL CORNIO_INPUT_DELAY

    BTFSS TRISD, RD2
    GOTO CORNIO_MOV4		; 4
    CALL CORNIO_INPUT_DELAY

    BTFSS TRISD, RD3
    GOTO CORNIO_MOV1		;1
    CALL CORNIO_INPUT_DELAY
    
    BSF PORTB, RB0
    
    BCF PORTB, RB1
    BTFSS TRISD, RD0
    GOTO CORNIO_MOV0		;0
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD1
    GOTO CORNIO_MOV8		;8
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD2
    GOTO CORNIO_MOV5		;5
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD3
    GOTO CORNIO_MOV2		;2
    CALL CORNIO_INPUT_DELAY
    
    BSF PORTB, RB1
    
    BCF PORTB, RB2
    BTFSS TRISD, RD0
    GOTO CORNIO_MOV_HASH	;#
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD3
    GOTO CORNIO_MOV3		;3
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD2
    GOTO CORNIO_MOV6		;6
    CALL CORNIO_INPUT_DELAY
	
    BTFSS TRISD, RD1
    GOTO CORNIO_MOV9		;9
    CALL CORNIO_INPUT_DELAY
    
    BSF PORTB, RB2
    GOTO CORNIO_EXIT
    
CORNIO_INPUT_DELAY:
    DELAY_MS D'2'
    RETURN
    
CORNIO_MOV_ASTER:
    MOVLW KEY_ASTER
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV_HASH:
    MOVLW KEY_HASH
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV0:
    MOVLW KEY_0
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV1:
    MOVLW KEY_1
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT	
CORNIO_MOV2:
    MOVLW KEY_2
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV3:
    MOVLW KEY_3
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV4:
    MOVLW KEY_4
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT	
CORNIO_MOV5:
    MOVLW KEY_5
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV6:
    MOVLW KEY_6
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV7:
    MOVLW KEY_7
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV8:
    MOVLW KEY_8
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT
CORNIO_MOV9:
    MOVLW KEY_9
    MOVWF CORNIO_INPUT_VAL
    GOTO CORNIO_EXIT

CORNIO_EXIT:
    DELAY_MS D'100'
    RETURN  
    
    #ENDIF
    ENDM
    
#ENDIF



